{% include "common/_header.html" %}

<div class="jumbotron">
  <div class="row">
    <div class="col-md-12">
      <div class="text-center">
        <h1>Simulation Overview</h1>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-2 col-md-offset-3">
      <div class="name-header">
        <b>Name:
        </b>
      </div>
      <div class="name-text">{{ simulation.name }}</div>
    </div>
    <div class="col-md-2">
      <div class="description-header">
        <b>Description:</b>
      </div>


      <div class="description-text">
        {{ simulation.description }}
      </div>
    </div>
    <div class="col-md-2">
      <div class="file-download-header">
        <b>Output:</b>
      </div>
      <div class="file-download-text">
        <a href="{{ simulation.output_file.url }}">
          <button href="{{ simulation.output_file.url }}" class="btn btn-success">Download as CSV</button>
        </a>
      </div>
    </div>
  </div>
</div>

<div class="row col-lg-12" align="center">
  <h3>2D Plot:</h3>
</div>

<div class="row">
  <div class="col-md-3 col-md-offset-3">
    <h4> Select X Axis Variable:</h4>
    <div class="radio" style="line-height:22px;">
    {% for name in variable_names %}
      {% if forloop.first %}
        <input type="radio" name="optionsRadiosX" id="checkbox-x-{{name}}" class="axis-checkbox-x" checked data-varkey="{{name}}"> {{name}}
        <br>
      {% else %}
        <input type="radio" name="optionsRadiosX" id="checkbox-x-{{name}}" class="axis-checkbox-x" data-varkey="{{name}}"> {{name}}
        <br>
      {% endif %}
    {% endfor %}
    </div>
  </div>
  <div class="col-md-3">
    <h4> Select Y Axis Variable:</h4>
    {% for name in variable_names %}
      {% if forloop.first %}
        <input type="checkbox" id="checkbox-y-{{name}}" class="axis-checkbox-y" data-varkey="{{name}}"> {{name}}
        <br>
      {% else %}
        <input type="checkbox" id="checkbox-y-{{name}}" class="axis-checkbox-y" checked data-varkey="{{name}}"> {{name}}
        <br>
        {% endif %}
      {% endfor %}
    </div>
</div>

<br><br>

<div class="row">
  <div class="col-md-8 col-md-offset-2">
    <div class="text-center">
      <div id="myChart"></div>
    </div>
  </div>
</div>

<br><br><br>

<div class="row" id="three-d">
  <div class="col-md-8 col-md-offset-2">
    <div class="text-center">
      <h3>3D Plot:</h3>
      <div id="myChart3d"></div>
    </div>
  </div>
</div>

<br><br>

<div class="row gauss-row">
  <div class="col-md-12">
    <div class="text-center gauss gauss-jumbotron" style="color:white;">
      GAUSS
    </div>
  </div>
</div>

<script>
  $(document).ready(function(){
    var mychart = document.getElementById("myChart");
    var mychart3d = document.getElementById("myChart3d");
    window.scireact = {}
    window.scireact.simulation_values = {{ simulation_values }};

    var keys = []
    for (key in window.scireact.simulation_values) {
      if (window.scireact.simulation_values.hasOwnProperty(key)) {
        keys.push(key);
      }
    }

    xVal = keys[keys.length-2]
    yVal = keys[keys.length-1]

    var data = [{
      x: window.scireact.simulation_values[xVal],
      y: window.scireact.simulation_values[yVal],
      type: "scatter"
    }]
    var layout = {
      title: "{{ simulation.name }}", 
      xaxis: {
        title: xVal, 
        titlefont: {
          family: "Courier New, monospace", 
          size: 18,
          color: "#7f7f7f"
        },
        autorange: true,
        zeroline: true
      }, 
      yaxis: {
        title: "Number", 
        titlefont: {
          family: "Courier New, monospace", 
          size: 18, 
          color: "#7f7f7f"
        },
        autorange: true,
        zeroline: true
      }
    };
    Plotly.plot(mychart, [], layout);
    $(".modebar-btn[data-title='Autoscale']")[0].click()

    var checkboxes = $( ":checkbox" )

    if (checkboxes.length > 3) {

      $("#three-d").addClass('hidden');
    }

    var selected = []
    var notSelected = []
    for (var i=0; i<checkboxes.length; i++) {
      if (checkboxes[i].checked)
        Plotly.addTraces(mychart, {'y': window.scireact.simulation_values[yVal] });
    }    

    $(".axis-checkbox-x").change(function(){
      var newX = $(this).data().varkey;

      if (keys.indexOf(newX) != -1)
        xVal = newX

      mychart.data[0].x = window.scireact.simulation_values[xVal];
      Plotly.redraw(mychart);

      var update = {
        title: "{{ simulation.name }}", 
        xaxis: {
          title: xVal, 
          titlefont: {
            family: "Courier New, monospace", 
            size: 18,
            color: "#7f7f7f"
          },
          autorange: true,
          zeroline: true
        }
      }
      Plotly.relayout(mychart, update)
      $(".modebar-btn[data-title='Autoscale']")[0].click()

    });

    $(".axis-checkbox-y").change(function(){
      var checkboxes = $( ":checkbox" )

      var selected = []
      var notSelected = []
      for (var i=0; i<checkboxes.length; i++) {
        if (checkboxes[i].checked)
          selected.push(checkboxes[i])
        else
          notSelected.push(checkboxes[i])
      }

      if ($(this).prop("checked")) {
        var newY = $(this).data().varkey;

        if (keys.indexOf(newY) != -1)
          yVal = newY;

        Plotly.addTraces(mychart, {'y': window.scireact.simulation_values[yVal] });
      }
      else {
        for (var i=0; i<selected.length+1; i++) {
          Plotly.deleteTraces(mychart, 0);
        }

        for (var j=0; j<selected.length; j++) {
          var newY = $(selected[j]).data().varkey;

          if (keys.indexOf(newY) != -1)
            yVal = newY;

          Plotly.addTraces(mychart, {'y': window.scireact.simulation_values[yVal], 'name': yVal});
        }

      }

      var update = {
        title: "{{ simulation.name }}", 
        xaxis: {
          title: xVal,
          titlefont: {
            family: "Courier New, monospace", 
            size: 18, 
            color: "#7f7f7f"
          },
          autorange: true,
          zeroline: true
        }
      }
      Plotly.relayout(mychart, update)
      $(".modebar-btn[data-title='Autoscale']")[0].click()
    });

    zVal = keys[0]
    var data3d = [{
      x: window.scireact.simulation_values[zVal],
      y: window.scireact.simulation_values[xVal],
      z: window.scireact.simulation_values[yVal],
      type: "scatter3d"
    }];
    var layout3d = {
      title: yVal + " vs " + zVal + " over " + xVal, 
      xaxis: {
        title: xVal, 
        titlefont: {
          family: "Courier New, monospace", 
          size: 18,
          color: "#7f7f7f"
        },
        autorange: true,
        zeroline: true
      },
      yaxis: {
        title: yVal, 
        titlefont: {
          family: "Courier New, monospace", 
          size: 18, 
          color: "#7f7f7f"
        },
        autorange: true,
        zeroline: true
      },
      zaxis: {
        title: zVal, 
        titlefont: {
          family: "Courier New, monospace", 
          size: 18, 
          color: "#7f7f7f"
        },
        autorange: true,
        zeroline: true
      }
    };
    Plotly.plot(myChart3d, data3d, layout3d);

  });
  
  function onLoad() {
    $(".axis-checkbox-y")[0].click();
    $(".axis-checkbox-y")[0].click();
  }

</script>

{% include "common/_footer.html" %}